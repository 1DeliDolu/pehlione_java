<!doctype html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Product Edit | Pehlione Shop</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&family=Source+Sans+3:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/style.css" th:href="@{/style.css}" />
  </head>
  <body
    class="page-settings"
    data-page="admin-product-edit"
    th:data-product-id="${productId}"
  >
    <div th:replace="~{nav :: main('settings','admin-product-edit')}"></div>

    <main class="container settings-shell">
      <div class="row g-4">
        <!-- Sidebar -->
        <aside class="col-lg-4">
          <div class="settings-card p-4 h-100">
            <span class="badge badge-soft rounded-pill px-3 py-2 mb-3"
              >Admin</span
            >
            <h1 class="h4 fw-bold mb-3">Edit Product</h1>

            <div class="settings-kv">
              <div class="small muted">Product ID</div>
              <div id="editProductIdDisplay" class="fw-semibold">
                <span th:text="${productId}">-</span>
              </div>
            </div>
            <div class="settings-kv mt-2">
              <div class="small muted">SKU</div>
              <div id="editProductSkuDisplay" class="small fw-semibold">-</div>
            </div>
            <div class="settings-kv mt-2">
              <div class="small muted">Signed in user</div>
              <div id="adminEditUserEmail" class="small">-</div>
            </div>
            <div class="settings-kv mt-2">
              <div class="small muted">Roles</div>
              <div id="adminEditUserRoles" class="small">-</div>
            </div>

            <hr />
            <div class="d-flex flex-column gap-2">
              <a
                href="/admin-product-create"
                class="btn btn-outline-dark btn-sm"
              >
                <i class="bi bi-plus-circle me-1"></i>Create New Product
              </a>
              <a href="/admin" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-arrow-left me-1"></i>Back to Admin
              </a>
            </div>

            <hr />
            <div class="small muted mb-1">Note</div>
            <div class="small">SKU cannot be changed after creation.</div>
            <div class="small mt-1">
              Image uploads are managed in the Images section below.
            </div>
          </div>
        </aside>

        <!-- Main content -->
        <section class="col-lg-8 d-flex flex-column gap-3">
          <div id="adminEditAuthAlert" class="alert alert-danger d-none mb-0">
            Admin yetkisi bulunamadi. Bu sayfa yalnizca ROLE_ADMIN icindir.
          </div>
          <div id="adminEditLoadError" class="alert alert-warning d-none mb-0">
            Urun yuklenemedi.
          </div>

          <!-- Base fields -->
          <div class="settings-card p-4">
            <h2 class="h5 fw-bold mb-3">Product Fields</h2>
            <form id="adminProductEditForm">
              <div class="row g-2">
                <div class="col-md-8">
                  <label class="form-label form-label-sm mb-1">Name *</label>
                  <input
                    id="adminEditName"
                    class="form-control form-control-sm"
                    placeholder="Product name"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label form-label-sm mb-1">Status *</label>
                  <select
                    id="adminEditStatus"
                    class="form-select form-select-sm"
                  >
                    <option value="ACTIVE">ACTIVE</option>
                    <option value="DRAFT">DRAFT</option>
                    <option value="ARCHIVED">ARCHIVED</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label form-label-sm mb-1">Price *</label>
                  <input
                    id="adminEditPrice"
                    type="number"
                    step="0.01"
                    min="0.01"
                    class="form-control form-control-sm"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label form-label-sm mb-1"
                    >Currency *</label
                  >
                  <input
                    id="adminEditCurrency"
                    class="form-control form-control-sm"
                    value="EUR"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label form-label-sm mb-1">Stock Qty</label>
                  <input
                    id="adminEditStock"
                    type="number"
                    min="0"
                    class="form-control form-control-sm"
                    value="0"
                  />
                </div>
                <div class="col-12">
                  <label class="form-label form-label-sm mb-1"
                    >Description</label
                  >
                  <textarea
                    id="adminEditDescription"
                    class="form-control form-control-sm"
                    rows="4"
                    placeholder="Optional description"
                  ></textarea>
                </div>
              </div>

              <hr />
              <h3 class="h6 fw-bold mb-2">Categories</h3>
              <div
                id="adminEditCategoryList"
                class="d-flex flex-column gap-2 small"
              >
                <div class="muted">Loading categories...</div>
              </div>

              <div class="d-flex justify-content-end mt-3">
                <button
                  id="adminEditSubmitBtn"
                  class="btn btn-brand"
                  type="submit"
                >
                  <i class="bi bi-check-circle me-1"></i>Save Changes
                </button>
              </div>
            </form>
          </div>

          <!-- Save result -->
          <div class="settings-card p-4">
            <h2 class="h5 fw-bold mb-2">Result</h2>
            <pre
              id="adminEditResult"
              class="small bg-light border rounded p-2 mb-0"
            >
-</pre
            >
          </div>

          <!-- Image management -->
          <div class="settings-card p-4">
            <h2 class="h5 fw-bold mb-3">Images</h2>

            <div id="adminEditImagesGallery" class="row g-2 mb-3">
              <div class="col-12 small muted">No images loaded.</div>
            </div>

            <hr />
            <h3 class="h6 fw-bold mb-2">Upload New Image</h3>
            <div class="row g-2 align-items-end">
              <div class="col-md-5">
                <label class="form-label form-label-sm mb-1">File</label>
                <input
                  id="adminEditImageFile"
                  type="file"
                  accept="image/*"
                  class="form-control form-control-sm"
                />
              </div>
              <div class="col-md-4">
                <label class="form-label form-label-sm mb-1">Alt Text</label>
                <input
                  id="adminEditImageAlt"
                  class="form-control form-control-sm"
                  placeholder="Optional alt text"
                />
              </div>
              <div class="col-md-3">
                <button
                  id="adminEditImageUploadBtn"
                  class="btn btn-outline-dark btn-sm w-100"
                  type="button"
                >
                  <i class="bi bi-cloud-upload me-1"></i>Upload
                </button>
              </div>
            </div>

            <hr />
            <h3 class="h6 fw-bold mb-2">Add by URL</h3>
            <div class="row g-2 align-items-end">
              <div class="col-md-5">
                <label class="form-label form-label-sm mb-1">Image URL</label>
                <input
                  id="adminEditImageUrl"
                  class="form-control form-control-sm"
                  placeholder="https://..."
                />
              </div>
              <div class="col-md-4">
                <label class="form-label form-label-sm mb-1">Alt Text</label>
                <input
                  id="adminEditImageUrlAlt"
                  class="form-control form-control-sm"
                  placeholder="Optional alt text"
                />
              </div>
              <div class="col-md-3">
                <button
                  id="adminEditImageUrlBtn"
                  class="btn btn-outline-dark btn-sm w-100"
                  type="button"
                >
                  <i class="bi bi-link-45deg me-1"></i>Add URL
                </button>
              </div>
            </div>

            <div id="adminEditImageResult" class="small mt-2 muted">-</div>
          </div>
        </section>
      </div>
    </main>

    <div th:replace="~{footer :: main('compact')}"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script
      src="/js/admin-product-edit.js"
      th:src="@{/js/admin-product-edit.js}"
    ></script>
  </body>
</html>
